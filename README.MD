## **RecSys karpov.courses**
Реализация проекта рекомендательной системы для социальной сети karpov.courses

### Стек технологий
python, numpy, pandas, matplotlib, seaborn, sklearn, pytorch, catboost, psycopg2, sqlalchemy

### Описание проекта
Социальная сеть обладает следующим функционалом: можно отправлять друг другу письма, создавать сообщества, аналогичные группам в известных сетях, и в этих сообществах публиковать посты.
При регистрации пользователи заполняют данные по своему профилю, которые хранятся postgres database.

Так же платформа обладает лентой, которую пользователи могут листать и просматривать случайные записи случайных сообществ. Если пост нравится, можно поддержать автора и поставить like.
Все действия пользователей сохраняются, каждая их активность, связанная с просмотром постов, тоже записывается к нам в базу.

Необходимо построить рекомендательную систему постов в социальной сети, то есть нужно реализовать сервис, который будет для каждого юзера в любой момент времени возвращать посты, которые пользователю покажут в его ленте соцсети.

### Требования к сервису
1. Время работы алгоритма: не более ~0.5 секунд на 1 запрос;
2. Затраты памяти: не более ~4 гб;
3. Набор пользователей фиксирован и никаких новых появляться не будет;
4. Модели не обучаются заново при использовании сервисов, поэтому код будет импортировать уже обученную модель и применять ее.

#### Оценка качества модели
Качество написанного вами алгоритма будет проверяться в чекере по скрытому для вас ряду user_id и ряду timestаmp (эмулируем запросы пользователей в разное время) по метрике **Hitrate@5**:

$$\frac{1}{{n \cdot t}} \sum_{t=1}^{T} \sum_{i=1}^{n} \min(1, \sum_{j=1}^{5}[a_{j}(x_{i}, t)=1]),$$

где:

* $n$ - количество юзеров
* $T$ - количество периодов проверки
* $a_{j}(x_{i}, t)$ - j-ая рекомендация i-ому пользователю в момент времени t;

В качестве прокси метрики использовался *roc_auc_score*

### Ход работы
В ходе работы над проектом были написаны 3 версии проекта и обучены 2 модели CatBoostClassifier.

**1. Версия сервиса, работающая с контрольной моделью классификации с Hitrate@5 > 0.52.**

На вход подаётся *id* пользователя, время отправки запроса и количество постов для рекомендации(default=5). Сервис возвращает заданное количество постов в формате JSON, содержащем *id* поста, тематику, текст поста

**2. Версия сервиса, работающая с тестовой моделью классификации с Hitrate@5 > 0.57**

Данная версия работает так же как первая версия, только с большей предсказательной способностью.

**3. Версия сервиса, работающая с обеими моделями для проведения A/B экспериментов. Данная версия умеет разбивать пользователей на группы и применять одну из двух моделей для рекомендаций**

Сервис получает те же входные данные, что и предыдущие. Возвращает группу, в которую попал пользователь (контрольная или тестовая), а так же посты и информацию о них

#### Исходные данные
Таблица *user_data* содержит информацию о всех пользователях соц.сети

|Field name|Overview|
|-|-|
|age|Возраст пользователя (в профиле)|
|city|Город пользователя (в профиле)|
|country|Страна пользователя (в профиле)|
|exp_group|Экспериментальная группа: некоторая зашифрованная категория|
|gender|Пол пользователя|
|user_id|Уникальный идентификатор пользователя|
|os|Операционная система устройства, с которого происходит пользование соц.сетью|
|source|Пришел ли пользователь в приложение с органического трафика или с рекламы|


Таблица *post_text_df* содержит информацию о постах и уникальный ID каждой единицы с соответствующим ей текстом и топиком

|Field name|Overview|
|-|-|
|id|Уникальный идентификатор поста|
|text|Текстовое содержание поста|
|topic|Основная тематика|
 

Таблица *feed_data* содержит историю о просмотренных постах для каждого юзера в изучаемый период.

|Field name|Overview|
|-|-|
|timestamp|Время, когда был произведен просмотр|
|user_id|id пользователя, который совершил просмотр|
|post_id|id просмотренного поста|
|action|Тип действия: *view* или *like*|
|target|1 у *view*, если почти сразу после просмотра был совершен лайк, иначе 0. У действий *like* 0|

#### Обработка сырых данных и обучение моделей

Ноутбуки с обработкой сырых данных для каждой модели:

[Контрольная модель](/training_models/control_model_training.ipynb)

[Тестовая модель](/training_models/test_model_training.ipynb)

#### Код сервисов

[Сервис с контрольной моделью](app_control.py)

[Сервис с тестовой моделью](app_test.py)

[Сервис для AB эксперимента](app_AB.py)